<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
  <head>
    <meta charset="utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,600" rel="stylesheet">

    <link href="{{ asset('css/app.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md mt-4 mb-4">
            <div class="card">
                <!-- Card header -->
                <div class="card-header h2">Ingresar carrera</div>

                <!-- Card body -->
                <div class="card-body">

                    <!-- Campo del nombre de la carrera -->
                    <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="careerName">Nombre *</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="careerName" id="careerName" maxlength="256" placeholder="Nombre" required>
                      </div>
                    </div>

                    <!-- Campo del codigo de la carrera -->
                    <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="careerCode">Codigo *</label>
                      <div class="col-sm-10">
                        <input type="text" class="form-control" name="careerCode" id="careerCode" maxlength="64" placeholder="Codigo" required>
                      </div>
                    </div>

                    <!-- Campo del departamento responsable de la carrera -->
                    <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="careerDepartment">Departamento *</label>
                      <div class="col">
                        <input type="text" class="form-control" name="careerDepartment" id="careerDepartment" maxlength="256" placeholder="Departamento" required>
                      </div>
                    </div>

                    <!-- Campo de docente a cargo -->
                    <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="careerProfessor">Docente a cargo *</label>
                      <div class="col">
                        <input type="text" class="form-control" name="careerProfessor" id="careerProfessor" maxlength="256" placeholder="Docente" required>
                      </div>
                    </div>

                    <!-- Campo de duracion de la carrera -->
                    <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="careerRuntime">Duraci칩n *</label>
                      <div class="col">
                        <input type="number" class="form-control" name="careerRuntime" id="careerRuntime" maxlength="256" placeholder="Duraci칩n" required>
                      </div>
                    </div>

                    <hr>

                    <div class="h3">
                      A침adir materias al plan
                    </div>

                    <table id ="Materias">
                        <tr>
                            <th>Nombre de Materia</th>
                            <th>A침o de la Materia</th>
                            <th>Cuatrimestre de la Materia</th>
                        </tr>
                        <tr>
                            <td id="col0">
                              <select id="signaturesSelect" name = "materiaName[]" value = ""/>
                            </td>
                            <td id="col1"><input type = "integer" name = "materiaAnio[]" value = ""/></td>
                            <td id="col2">
                              <select name="materiaCuatrimestre[]" id="cuatri">
                                <option value="0">Seleccionar Cuatrimestre</option>
                                <option value="1">Primer Cuatrimestre</option>
                                <option value="2">Segundo Cuatrimestre</option>
                              </select>
                        </tr>
                    </table>
                    <table> 
		                <tr> 
			                <td><input class="btn btn-dark" type="button" value="Agregar Materia" onclick="addRows()" /></td> 
			                <td><input class="btn btn-dark" type="button" value="Eliminar Materia" onclick="deleteRows()" /></td>
		                </tr>  
	                </table>
                    <hr>
                    <button id="saveButton" class="btn btn-dark float-right">Guardar</button>
                  
                </div>
            </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      window.onload = function() {
        let select = document.getElementById('signaturesSelect');
        axios.post('https://pss2020api.herokuapp.com/api/materia/search',
        {
          "search": "",
        }
        ).then(function (response) {
          console.log(response);
          if(response.status == 200){
            response.data.materias.forEach( materia => {
              document.getElementById('signaturesSelect').add(makeOption(materia))
          });
        }
        })
      }
               

      function makeOption(materia) {
        let option = document.createElement("option");
        option.appendChild(document.createTextNode(""+materia['nombre']));
        return option;
      }

      let saveButton = document.getElementById('saveButton');
      saveButton.addEventListener('click', (event) => {
        axios.post('https://pss2020api.herokuapp.com/api/carrera',
          {
            "nombre": document.getElementById("careerName").value,
            "identificador": document.getElementById("careerCode").value,
            "dpto": document.getElementById("careerDepartment").value,
            "docente": document.getElementById("careerProfessor").value,
            "duracion": document.getElementById("careerRuntime").value
          }
        ).then(function (response) {
          console.log(response);
        })
      });

      function addRows(){ 
        var table = document.getElementById('Materias');
        var rowCount = table.rows.length;
        var cellCount = table.rows[0].cells.length; 
        var row = table.insertRow(rowCount);
        for(var i =0; i <= cellCount; i++){
          var cell = 'cell'+i;
          cell = row.insertCell(i);
          var copycel = document.getElementById('col'+i).innerHTML;
          cell.innerHTML=copycel;
        }
      }

      function deleteRows(){
        var table = document.getElementById('Materias');
        var rowCount = table.rows.length;
        if(rowCount > '2'){
          var row = table.deleteRow(rowCount-1);
          rowCount--;
        }
        else{
          alert('Se necesita al menos 1 fila');
        }
    }

    </script>

    <script type="text/javascript">
    
   </script>
  </body>
</html>
